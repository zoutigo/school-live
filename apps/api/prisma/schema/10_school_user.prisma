model School {
  id           String                @id @default(cuid())
  slug         String                @unique
  name         String
  logoUrl      String?
  primaryColor String?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  users        User[]
  students     Student[]
  teachers     Teacher[]
  classes      Class[]
  subjects     Subject[]
  assignments  TeacherClassSubject[]
  grades       Grade[]
}

model User {
  id             String         @id @default(cuid())
  schoolId       String
  email          String?
  phone          String?
  passwordHash   String
  role           Role
  firstName      String
  lastName       String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  school         School         @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  teacherProfile Teacher?
  studentProfile Student?
  parentLinks    ParentStudent[] @relation("ParentLinks")
  gradesGiven    Grade[]        @relation("GradeTeacher")
  teachingAssignments TeacherClassSubject[]
  refreshTokens  RefreshToken[]

  @@unique([schoolId, email])
  @@index([schoolId])
}

model RefreshToken {
  id           String   @id @default(cuid())
  userId       String
  tokenHash    String   @unique
  expiresAt    DateTime
  revokedAt    DateTime?
  replacedById String?
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}
