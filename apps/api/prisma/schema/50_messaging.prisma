model InternalMessage {
  id              String                @id @default(cuid())
  schoolId        String
  senderUserId    String
  status          InternalMessageStatus @default(SENT)
  subject         String
  body            String
  sentAt          DateTime?
  senderArchivedAt DateTime?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  school          School                @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  senderUser      User                  @relation("InternalMessageSender", fields: [senderUserId], references: [id], onDelete: Cascade)
  recipients      InternalMessageRecipient[]

  @@index([schoolId])
  @@index([senderUserId])
  @@index([status])
  @@index([sentAt])
  @@index([createdAt])
}

model InternalMessageRecipient {
  id             String          @id @default(cuid())
  messageId      String
  schoolId       String
  recipientUserId String
  readAt         DateTime?
  archivedAt     DateTime?
  deletedAt      DateTime?
  createdAt      DateTime        @default(now())
  message        InternalMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  school         School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  recipientUser  User            @relation("InternalMessageRecipientUser", fields: [recipientUserId], references: [id], onDelete: Cascade)

  @@unique([messageId, recipientUserId])
  @@index([schoolId])
  @@index([recipientUserId])
  @@index([archivedAt])
  @@index([readAt])
  @@index([deletedAt])
}
