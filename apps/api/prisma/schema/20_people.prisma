model Student {
  id           String          @id @default(cuid())
  schoolId     String
  userId       String?
  firstName    String
  lastName     String
  classId      String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  school       School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  user         User?           @relation(fields: [userId], references: [id], onDelete: SetNull)
  class        Class?          @relation(fields: [classId], references: [id], onDelete: SetNull)
  parentLinks  ParentStudent[] @relation("StudentLinks")
  grades       Grade[]

  @@index([schoolId])
  @@index([classId])
  @@unique([schoolId, userId])
}

model ParentStudent {
  id           String   @id @default(cuid())
  schoolId     String
  parentUserId String
  studentId    String
  createdAt    DateTime @default(now())
  parent       User     @relation("ParentLinks", fields: [parentUserId], references: [id], onDelete: Cascade)
  student      Student  @relation("StudentLinks", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([parentUserId, studentId])
  @@index([schoolId])
  @@index([studentId])
}

model Teacher {
  id        String   @id @default(cuid())
  schoolId  String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  school    School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([schoolId])
  @@unique([schoolId, userId])
}

model UserRecoveryAnswer {
  id          String              @id @default(cuid())
  userId      String
  questionKey RecoveryQuestionKey
  answerHash  String
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, questionKey])
  @@index([userId])
}
